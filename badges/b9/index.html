<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="../../d3.js"></script>
<style>
html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  margin: 0;
  padding: 0;
}

</style>
<script>

// originally from: bl.ocks.org/RandomEtc/5165219

var w = 1050,
    h = 1500

tributary = { sw: w, sh: h }

/*
experiment with making gifs
http://jnordberg.github.io/gif.js
*/

//for @zeffii by @gelicia: http://tributary.io/inlet/6384402
//http://beesandbombs.tumblr.com/post/58615106167
var canvas = d3.select("body").style("background-color", d3.rgb(25, 25, 25)).append('canvas')
  .attr({width: w, height: h})

var context = canvas.node().getContext('2d')

context.globalCompositeOperation = "xor";

var offset = 0;
var radius = 15;
var radiusAdd = 34;
var spacing = 50;
var numRowsH = tributary.sh / (spacing-radius);
var numRowsW = tributary.sw / (spacing-radius);
var colorScale = d3.scale.linear()
  .interpolate(d3.interpolateHsl)
    .domain([0, 1])
    .range(["#531717", "#2D2D80"]);

function circle(x, y, r, fillstyle){
  context.beginPath();
  context.arc(x, y, r, 0, 2.0*Math.PI, false);
  context.fillStyle = fillstyle;
  context.fill();
}

function run(unused, t){
  //thanks @slembcke :D  
  var easedT = t*t*(3 - 2*t);

   context.clearRect(0, 0, tributary.sw, tributary.sh);
   for (var i = 0; i < numRowsW; i++) {
       for (var j = 0; j < numRowsH; j++) {
         circle(
           ((spacing-7) * i) + offset, 
           (spacing * j) + (i % 2 === 0 ? spacing/2 : 0) + offset, 
           (radiusAdd * easedT) + radius,
       colorScale(easedT).toString()
         );
        }
   }
};

var t = 0; var steps = 0
window.step = function() {
  if(steps++ > 10) return
  t+=0.12;
  run(0, t);
}


is_ready = true

;(function(){
  if(!window.step) window.step = null
  // debuggin snippet for when not in an iframe
  if(window.self !== window.top) return
  ;(function check(){ if(!is_ready) return setTimeout(check, 100); setInterval(step, 100) })()
})()

</script>