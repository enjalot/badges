<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="../../d3.js"></script>
<style>
html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  margin: 0;
  padding: 0;
}
</style>
<script>

// originally from: bl.ocks.org/RandomEtc/5165219

var w = 1050,
    h = 1500

var width = w, height = h

tributary = { sw: w, sh: h }

  var body = d3.select("body").style("background-color", "rgb(85,36,106)")
  var canvas = body.append('canvas').attr({width: w, height: h})
  var ctx = canvas.node().getContext('2d')
  tributary.ctx = ctx
  ctx.globalCompositeOperation = 'source-over';

//http://spot.colorado.edu/~lessley/pdf%20stuff/lasermath2.pdf


var x0 = 342;
var y0 = 1373;

var a = 526;
var b = 10;
//var b = (n-1)/(n+10);

var hx = 2004;
var hy = -1357;

var fbase = 42;
var omega0 = -19 * Math.PI * fbase;

var om = omega0 * 0.32721;

var tempo = -4;
var erasing = 0.001;
var linen = 116;
var cs = d3.interpolateHsl("#3F4DEC", "#0CE97F");
var sopacity = 0.32032;
var cf = d3.interpolateHsl("#b41bde", "#298b1c");
var fopacity = 0.5;
var radius = 80
;
                                                   
var nt = 151;
var to = 0.296;

function x(t, o) {
  //return (a - b) * Math.cos(omega0*t) + h * Math.cos(omega0*t*(a/b-1));
  return (a - b) * Math.cos(o*t) + hx * Math.cos(o*t*(a-b)/b);
  //return h * Math.cos(t*Math.PI);
}
function y(t, o) {
  //return (a - b) * Math.sin(omega0*t) - h * Math.sin(omega0*t*(a/b-1));
  return (a - b) * Math.tan(o*t) - hy * Math.cos(o*t*(a-b)/b);
  //return h * Math.sin(t*Math.PI);
}

function circle(ctx, p) {
    //ctx.fillStyle = 'hsla(0,0%,' + 70 +'%,' + 1 + ')';
    ctx.beginPath();
    ctx.arc(p[0],p[1],radius,0,2*Math.PI);
    ctx.fill();
}
function line(ctx) {  
  ctx.beginPath();
  var i;
  for(i=0;i<linen;i++) {
      //ctx.strokeStyle = c(i/linen);
    ctx.lineTo(x0 + x(i/linen, omega0), y0 + y(i/linen, omega0));
  }
  ctx.stroke();
  
}
  

tributary.run = function(ctx,t) {
    //tributary.clear(); //helper function to clear the canvas 
    ctx.fillStyle = "rgba(9,9,9," + erasing +  ")";
    ctx.fillRect(0,0,tributary.sw,tributary.sh);
    var tt = (t % 10)/tempo;
    
    var p;
    


    ctx.strokeStyle = cs(tt);
  line(ctx);
    
    p = [x0 + x(tt, om), y0 + y(tt, om)]; 
    ctx.fillStyle = cf(tt);
    circle(ctx, p);
  
    
    var i = 0;
    for(i = 0; i < nt; i++) {
      //p = [x0 + x(tt+i*tt/2, om), y0 + y(tt+i*tt/2, om)]; 
      p = [x0 + x(tt+i*to, om), y0 + y(tt+i*to, om)]; 
      ctx.fillStyle = cf(tt);
      circle(ctx, p);
    }
    
  
};

var t = 0; steps = 0
function step() {
  if(steps++ > 10) return
  t+= 0.1;
  tributary.run(tributary.ctx, t);
}


is_ready = true

;(function(){
  if(!window.step) window.step = null
  // debuggin snippet for when not in an iframe
  if(window.self !== window.top) return
  ;(function check(){ if(!is_ready) return setTimeout(check, 100); setInterval(step, 100) })()
})()

</script>