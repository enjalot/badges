<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="../../d3.js"></script>
<script src="../../topojson.js"></script>
<style>
  body{
    margin: 0;
  }
</style>
<script>

// originally from: http://bl.ocks.org/mbostock/3734273

// width = window.innerWidth, height = window.innerHeight
var width = 1050, height = 1500

var velocity = 180,
    t0 = Date.now();

var projection = d3.geo.equirectangular()
  .translate([width/2, height/2])
  .scale(500)

var canvas = d3.select("body").append("canvas")
    .attr("width", width)
    .attr("height", height);

var context = canvas.node().getContext("2d");

var path = d3.geo.path()
    .projection(projection)
    .context(context);

d3.json("world-110m.json", function(error, world) {
  var land = topojson.feature(world, world.objects.land);


  var steps = 0
  window.step = function() {
    if(steps++ > 10) return
    t = steps / 9
    projection.rotate([0, velocity * t - 90]);
    context.beginPath();
    context.fillStyle = '#3498db';
    context.rect(0, 0, width, height);
    context.fill();
    context.closePath();
    context.beginPath();
    context.fillStyle = '#2ecc71';
    path(land);
    context.fill();
    context.stroke();
    context.closePath();
  }
  window.is_ready = true
});


// debugging snippet for when not in an iframe
;(function(){
  if(window.self !== window.top) return
  ;(function check(){ if(!window.is_ready) return setTimeout(check, 100); setInterval(step, 100) })()
})()

</script>


</script>
