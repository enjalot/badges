<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="../../d3.js"></script>
<style>
html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  margin: 0;
  padding: 0;
  background-color: black;
}

svg {
  background-color: #c0392b;
  width: 1050px;
  height: 1500px;
}

path, line, circle {
  stroke-width:50;
  fill: none;
  stroke: #333;
}

</style>
<script>

var w = 1050, h = 1500

var width = w, height = h

var svg = d3.select('body').append("svg").attr({width: w, heigth: h})

var n = 100;
var theta = 6 * Math.PI/4;

var tributary = { sw: w, sh: h }
var hatSize = tributary.sw/15;
var legLength = tributary.sh/3;
var armLength = tributary.sw/2;

var xscale = d3.scale.linear()
.domain([0, n])
.range([0, armLength])

var yscale = d3.scale.linear()
.domain([-1, 1])
.range([100, 0])

var path = d3.svg.line()
.x(function(d,i) { return xscale(d.x) })
.y(function(d,i) { return yscale(d.y) })



var vis = svg.append("g")
.classed("piman", true)

vis.append("path").classed("arms", true)
vis.append("line").classed("left-leg", true)
vis.append("line").classed("right-leg", true)
vis.append("circle").classed("head", true)

var run = function(g, t, cloneIndex) {
  var vis = g.select(".piman", true)
  vis.attr("transform", "translate(" + [tributary.sw/4 - 60, tributary.sh/2] + ") scale(1.5)");
  
  var y = function(x) {
  }
  
  var data = d3.range(n).map(function(d,i) {
    var o = (theta * t) + theta * d/n;
    var y = Math.sin(o);
    return {
      x: i, y:y
    }
  })
  vis.select("path.arms")
    .data([data])
    .attr("d", path)
  
  var lx = n/3;
  var ly = Math.sin((theta * t) + theta * lx/n)
  vis.select("line.left-leg")
  .attr({
    x1: xscale(lx),
    y1: yscale(ly),
    x2: xscale(lx),
    y2: legLength
  })
  
  var rx = 2*n/3
  var ry = Math.sin((theta * t) + theta * rx/n)
  vis.select("line.right-leg")
  .attr({
    x1: xscale(rx),
    y1: yscale(ry),
    x2: xscale(rx),
    y2: legLength
  })
  
  var cx = n/2;
  var cy = 0.5 * Math.sin((theta * t) + theta * cx/n)
  vis.select("circle.head")
  .attr({
    cx: xscale(n/2),
    cy: yscale(cy) - hatSize*2,
    r: hatSize
  })
}



var steps = 0
function step() {
  if(steps++ > 10) return
  // todo
  run(svg, steps / 9)
}

window.is_ready = true

;(function(){
  if(!window.step) window.step = null
  // debuggin snippet for when not in an iframe
  if(window.self !== window.top) return
  ;(function check(){ if(!is_ready) return setTimeout(check, 100); setInterval(step, 100) })()
})()

</script>