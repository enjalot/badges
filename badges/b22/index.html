<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="../../d3.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<style>
html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  margin: 0;
  padding: 0;
  background-color: #333;
}

svg, canvas{
  background-color: #3498db;
}
path {
  fill: #2ecc71;
  stroke: #000;
}

circle {
  fill: none;
  stroke: #000;
  stroke-width: 3px;
}

</style>
<script>

var w = 1050, h = 1500

var width = w, height = h

var width = w,
    height = h;

var velocity = .01,
    t0 = Date.now();

var projection = d3.geo.equirectangular()
    .translate([w/2, h/ 2])
    .scale(350);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var root = svg.append('g')
root.attr('transform', 'translate(1300,0) rotate(90)')

var path = d3.geo.path()
    .projection(projection)

var sel = root.append('path')

d3.json("./world-110m.json", function(error, world) {
  var land = topojson.feature(world, world.objects.land);
  window.is_ready = true
  window.draw = function(){
    projection.rotate([0, velocity * steps * 2000, 0])
    sel.attr('d', path(land))
  }
});



var steps = 0
function step() {
  if(steps++ > 10) return
  draw()
}

;(function(){
  if(!window.step) window.step = null
  // debuggin snippet for when not in an iframe
  if(window.self !== window.top) return
  ;(function check(){ if(!window.is_ready) return setTimeout(check, 100); setInterval(step, 100) })()
})()

</script>