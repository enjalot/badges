<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="../../d3.js"></script>
<style>
html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  margin: 0;
  padding: 0;
  background-color: #333;
}
svg{
  background-color: #2c3e50;
}
circle{
  fill: #f1c40f;
}
</style>
<script>

// originally from: bl.ocks.org/RandomEtc/5165219

var w = 1050,
    h = 1500

var width = w, height = h

tributary = { sw: w, sh: h }

var body = d3.select("body").attr('id', 'display')


var gosper = [
  '                        x',
  '                      x x',
  '            xx      xx            xx',
  '           x   x    xx            xx',
  'xx        x     x   xx',
  'xx        x   x xx    x x',
  '          x     x       x',
  '           x   x',
  '            xx'
]
  , rPentomino = [
  ' xx',
  'xx',
  ' x'];

var cells = init(rPentomino);

var svg = d3.select('body').append('svg')
            .attr('width', w)
            .attr('height', h)
            .append('g')
              .attr('transform', 'translate(' + [w/2, h/2] + ')')
  , circles = svg.selectAll('circle');

function original_step() {
  render(cells);

  var nextCells = {}
    , coords = Object.keys(cells)
    , empties = []
    , i, n, cell;
  for (i = 0; i < coords.length; i++) {
    cell = cells[coords[i]];
    n = neighbors(cells, cell, empties);
    if (n === 2 || n === 3)
      nextCells[cell] = cell;
  }

  for (i = 0; i < empties.length; i++) {
    cell = empties[i];
    n = neighbors(cells, cell);
    if (n === 3)
      nextCells[cell] = cell;
  }

  cells = nextCells;
}

function init(rows) {
  var board = {}
    , columns;
  for (i = 0; i < rows.length; i++) {
    columns = rows[i].split('');
    for (j = 0; j < columns.length; j++)
      if (columns[j] != ' ')
        board[[i, j]] = [i, j];
  }

  return board;
}

function neighbors(cells, coords, empties) {
  var n = 0, dx, dy, dc;

  coords[0] = parseInt(coords[0]);
  coords[1] = parseInt(coords[1]);

  for (dx = -1; dx <= 1; dx++) {
    for (dy = -1; dy <= 1; dy++) {
      if (dx === 0 && dy === 0) continue;

      dc = [coords[0] + dx, coords[1] + dy];
      if (cells[dc])
        n++;
      else if (empties)
        empties.push(dc);
    }
  }

  return n;
}

var scale = 10
function render(cells) {
  circles = circles
    .data(d3.map(cells).values(), function(c) { return c })

  circles.enter().append('circle')
    .attr('cx', function(c) { return c[1] * 10 * scale })
    .attr('cy', function(c) { return c[0] * 10 * scale })
    .attr('r', 6 * scale)

  circles.exit().remove();
}


var steps = 0
function step() {
  if(steps++ > 10) return
  for(var i = 0; i < 1; i++) original_step()
}

is_ready = true

;(function(){
  if(!window.step) window.step = null
  // debuggin snippet for when not in an iframe
  if(window.self !== window.top) return
  ;(function check(){ if(!is_ready) return setTimeout(check, 100); setInterval(step, 100) })()
})()

</script>